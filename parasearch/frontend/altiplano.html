<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Altiplano — Llama-Powered Parametric Search</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{
      /* Altiplano palette (from the logo) */
      --cream: #fcf7ef;
      --paper: #f6efe4;
      --sand: #f0e4d3;
      --gold: #e6aa3a;
      --ocher: #d9862e;
      --terracotta: #c96123;
      --brown-900: #4b2f22;
      --brown-700: #6a4330;
      --brown-500: #8a5b45;

      --ring: var(--brown-900);
      --pill: var(--brown-900);
      --accent: var(--ocher);
      --accent2: var(--terracotta);
      --text: #2d241f;
      --muted: #6f6258;
      --ok: #2d6a4f;
      --warn: #8a5b00;
      --bad: #8a2c2c;
      --shadow: 0 12px 40px rgba(75,47,34,.18);
      --shadow-strong: 0 18px 60px rgba(75,47,34,.24);
      --radius-lg: 22px;
      --radius-xl: 28px;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background:
        radial-gradient(1200px 800px at 20% 0%, #fff8 0%, #fff0 60%),
        radial-gradient(900px 600px at 100% 100%, #00000010 0%, #0000 60%),
        var(--cream);
      min-height:100vh;color:var(--text);
    }

    .app{max-width:960px;margin:0 auto;padding:28px}

    /* Header */
    .header{display:flex;flex-direction:column;align-items:center;gap:18px;padding:24px 0 18px;animation:fadeIn .6s ease}
    .brand{
      display:flex;align-items:center;gap:14px
    }
    .brand img{
      width:72px;height:72px;border-radius:999px;border:3px solid var(--ring);background:var(--paper);object-fit:cover;box-shadow:var(--shadow)
    }
    .wordmark{
      font-size:2.4rem;letter-spacing:.06em;font-weight:900;color:var(--brown-900);
      text-transform:uppercase
    }
    .tagline{
      color:var(--muted);font-size:.98rem;text-align:center
    }
    .beta-badge{
      display:inline-block;margin-left:8px;padding:4px 10px;border-radius:999px;
      border:1.5px solid #0000001a;background:var(--sand);color:var(--brown-700);font-weight:700;font-size:.72rem
    }

    /* Search */
    .search-wrap{margin:22px 0 28px}
    .search-container{
      background:var(--paper);
      border-radius:var(--radius-xl);
      padding:10px 14px;border:2px solid var(--pill);
      box-shadow:var(--shadow);
      display:flex;align-items:center;gap:12px;transition:.25s ease;
    }
    .search-container:focus-within{transform:translateY(-1px);box-shadow:var(--shadow-strong)}
    .search-pill{
      display:flex;align-items:center;gap:10px;background:var(--cream);border:2px solid var(--pill);
      padding:6px 12px;border-radius:999px;color:var(--brown-900);font-weight:900;letter-spacing:.06em;text-transform:uppercase
    }
    .search-pill .mag{display:inline-block;width:20px;height:20px;border:2px solid var(--brown-900);border-radius:50%;position:relative}
    .search-pill .mag::after{content:"";position:absolute;right:-6px;bottom:-6px;width:10px;height:2px;background:var(--brown-900);transform:rotate(45deg);border-radius:2px}
    .search-input{
      flex:1;border:none;outline:none;background:transparent;
      font-size:1rem;padding:12px 8px;color:var(--text)
    }
    .search-button{
      background:linear-gradient(180deg,var(--accent) 0%, var(--accent2) 100%);
      color:#fff;border:none;padding:12px 20px;border-radius:999px;font-weight:800;cursor:pointer;
      transition:.25s ease;letter-spacing:.02em
    }
    .search-button:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 24px rgba(201,97,35,.35)}
    .search-button:disabled{opacity:.6;cursor:not-allowed}

    /* Banners & states */
    .warning-banner{
      background:#ffe8b3;color:#4a3a12;padding:12px 16px;border-radius:16px;border:1.5px solid #e0b55e;margin-bottom:18px;display:flex;gap:10px;align-items:center;animation:slideDown .35s ease
    }
    .loading{text-align:center;padding:38px;color:var(--brown-700)}
    .spinner{border:3px solid #0001;border-top-color:var(--brown-900);width:42px;height:42px;border-radius:50%;margin:0 auto 12px;animation:spin 1s linear infinite}

    /* Results */
    .results-container{animation:fadeIn .45s ease}
    .results-header{
      background:var(--paper);padding:14px 16px;border-radius:16px;border:1.5px solid #00000012;margin-bottom:16px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px
    }
    .results-info{color:var(--muted);font-size:.92rem}
    .results-meta{display:flex;gap:14px;color:var(--muted);font-size:.86rem}
    .meta-item{display:flex;gap:6px;align-items:center}

    .result-card{
      background:white;border:1.5px solid #00000010;border-radius:18px;padding:22px;margin-bottom:14px;box-shadow:0 6px 18px rgba(75,47,34,.08);transition:.25s ease;animation:slideUp .35s ease
    }
    .result-card:hover{transform:translateY(-3px);box-shadow:0 12px 28px rgba(75,47,34,.14)}
    .result-header{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;margin-bottom:10px}
    .result-title{font-weight:800;font-size:1.18rem;color:var(--brown-700);line-height:1.28}
    .result-badges{display:flex;gap:8px;flex-shrink:0}
    .confidence-badge{
      padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:800;border:1.5px solid #00000012
    }
    .confidence-high{background:#e7f4ec;color:var(--ok)}
    .confidence-medium{background:#fff2cf;color:var(--warn)}
    .confidence-low{background:#fde4e4;color:var(--bad)}
    .relevance-badge{
      padding:4px 10px;border-radius:999px;font-size:.75rem;font-weight:900;color:#fff;
      background:linear-gradient(180deg,var(--brown-700),var(--brown-900))
    }
    .result-snippet{color:#3b322c;line-height:1.6;margin-bottom:10px}
    .result-expanded{color:#5a4f47;line-height:1.7;padding:14px;background:var(--sand);border-radius:14px;margin-top:10px;border-left:4px solid var(--accent)}
    .expand-button{
      margin-top:8px;background:transparent;border:2px solid var(--brown-900);color:var(--brown-900);
      padding:8px 14px;border-radius:999px;cursor:pointer;font-weight:800;font-size:.86rem;transition:.2s
    }
    .expand-button:hover{background:var(--brown-900);color:#fff}

    .risk-indicator{display:inline-flex;gap:6px;align-items:center;font-size:.82rem;color:var(--muted);margin-top:8px}
    .risk-high{color:var(--bad)}

    /* Empty state */
    .empty-state{text-align:center;padding:64px 20px;color:var(--brown-700)}
    .empty-logo{display:flex;justify-content:center;margin-bottom:16px}
    .empty-logo .round{width:84px;height:84px;border-radius:999px;background:var(--paper);border:3px solid var(--ring);display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow)}
    .empty-title{font-size:1.4rem;font-weight:900;letter-spacing:.04em;color:var(--brown-900);margin:6px 0 6px}
    .empty-subtitle{color:var(--muted)}
    .suggestions{margin-top:26px;display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .suggestion-chip{
      background:var(--paper);color:var(--brown-900);padding:9px 14px;border-radius:999px;border:1.5px solid var(--ring);
      cursor:pointer;font-weight:700;transition:.18s
    }
    .suggestion-chip:hover{transform:translateY(-2px)}

    /* Footer */
    .footer{text-align:center;color:var(--muted);padding:40px 20px 20px;font-size:.88rem}
    .footer-links{display:flex;justify-content:center;gap:18px;margin-top:12px;flex-wrap:wrap}
    .footer-link{color:var(--brown-700);text-decoration:none;border-bottom:1px dotted #0000;transition:.2s}
    .footer-link:hover{border-bottom-color:currentColor}

    /* Animations */
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes spin{to{transform:rotate(360deg)}}

    @media (max-width:768px){
      .app{padding:18px}
      .wordmark{font-size:1.9rem}
      .result-title{font-size:1.05rem}
      .result-header{flex-direction:column;align-items:flex-start}
      .results-meta{flex-direction:column;gap:6px}
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const API_URL = window.location.hostname === 'localhost'
      ? 'http://localhost:8000'
      : window.location.origin;

    function App(){
      const [query,setQuery] = useState('');
      const [results,setResults] = useState(null);
      const [loading,setLoading] = useState(false);
      const [error,setError] = useState(null);
      const [expandedResults,setExpanded] = useState(new Set());
      const [searchHistory,setHistory] = useState([]);

      const exampleQueries = [
        "Who was Leonardo da Vinci?",
        "Explain quantum mechanics",
        "History of the Roman Empire",
        "How does photosynthesis work?",
        "What is machine learning?",
        "Ancient Egyptian pyramids"
      ];

      const handleSearch = async (q = query) => {
        if(!q.trim()) return;
        setLoading(true); setError(null); setResults(null); setExpanded(new Set());
        try{
          const res = await fetch(`${API_URL}/search`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ query: q, num_results: 5, temperature: 0.3 })
          });
          if(!res.ok){
            const e = await res.json();
            throw new Error(e.detail || 'Search failed');
          }
          const data = await res.json();
          setResults(data);
          setHistory(prev => [q, ...prev.filter(x=>x!==q)].slice(0,5));
        }catch(err){
          setError(err.message);
        }finally{
          setLoading(false);
        }
      };

      const toggleExpanded = (i)=>{
        const n = new Set(expandedResults);
        n.has(i) ? n.delete(i) : n.add(i);
        setExpanded(n);
      };

      const cls = (c)=>{
        if(c>=0.7) return 'confidence-high';
        if(c>=0.4) return 'confidence-medium';
        return 'confidence-low';
      };
      const label = (c)=> `${Math.round(c*100)}% confident`;

      return (
        <div className="app">
          <header className="header">
            <div className="brand">
              <!-- Update src if your path differs -->
              <img src="/altiplano-graphic-mark-logo.svg" alt="Altiplano logo"/>
              <div className="wordmark">ALTIPLANO</div>
            </div>
            <div className="tagline">
              Llama-powered parametric knowledge search
              <span className="beta-badge">BETA</span>
            </div>
          </header>

          <div className="search-wrap">
            <div className="search-container">
              <div className="search-pill">
                <span className="mag" aria-hidden="true"></span>
                <span>ALTIPLANO</span>
              </div>
              <input
                className="search-input"
                placeholder="Ask anything… (uses model knowledge only)"
                value={query}
                onChange={(e)=>setQuery(e.target.value)}
                onKeyDown={(e)=> e.key==='Enter' && handleSearch()}
                disabled={loading}
              />
              <button className="search-button" onClick={()=>handleSearch()} disabled={loading || !query.trim()}>
                {loading ? 'Searching…' : 'Search'}
              </button>
            </div>
          </div>

          {loading && (
            <div className="loading">
              <div className="spinner"></div>
              <div>Traversing the high plains of knowledge…</div>
            </div>
          )}

          {error && (
            <div className="warning-banner">
              <strong>⚠️ Error:</strong> {error}
            </div>
          )}

          {results && (
            <div className="results-container">
              {results.warning && (
                <div className="warning-banner">
                  <span>💡</span> {results.warning}
                </div>
              )}

              <div className="results-header">
                <div className="results-info">
                  Found {results.results.length} results for "{results.query}"
                </div>
                <div className="results-meta">
                  <div className="meta-item">⏱️ {results.processing_time}s</div>
                  <div className="meta-item">🧠 {results.model_used}</div>
                  <div className="meta-item">📅 {results.knowledge_cutoff}</div>
                </div>
              </div>

              {results.results.map((r, i)=>(
                <div key={i} className="result-card">
                  <div className="result-header">
                    <div className="result-title">{r.title}</div>
                    <div className="result-badges">
                      <div className={`confidence-badge ${cls(r.confidence)}`}>{label(r.confidence)}</div>
                      <div className="relevance-badge">{r.relevance_score}/10</div>
                    </div>
                  </div>
                  <div className="result-snippet">{r.snippet}</div>
                  {r.expanded_content && (
                    <>
                      {expandedResults.has(i) && (
                        <div className="result-expanded">{r.expanded_content}</div>
                      )}
                      <button className="expand-button" onClick={()=>toggleExpanded(i)}>
                        {expandedResults.has(i) ? '▲ Show Less' : '▼ Learn More'}
                      </button>
                    </>
                  )}
                  {r.hallucination_risk !== 'low' && (
                    <div className={`risk-indicator ${r.hallucination_risk==='high' ? 'risk-high':''}`}>
                      {r.hallucination_risk==='high' ? '⚠️' : 'ℹ️'}
                      Uncertainty level: {r.hallucination_risk}
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {!loading && !results && !error && (
            <div className="empty-state">
              <div className="empty-logo">
                <div className="round">
                  <span className="mag" style="display:block;transform:scale(1.2)"></span>
                </div>
              </div>
              <div className="empty-title">Welcome to Altiplano</div>
              <div className="empty-subtitle">
                Searches use only the model's internal knowledge — no web, no external DBs.
              </div>
              <div className="suggestions" style={{marginTop:'20px'}}>
                <div style={{width:'100%',marginBottom:'8px',color:'var(--muted)'}}>Try:</div>
                {exampleQueries.map((ex,idx)=>(
                  <div key={idx} className="suggestion-chip" onClick={()=>{setQuery(ex);handleSearch(ex);}}>
                    {ex}
                  </div>
                ))}
              </div>
            </div>
          )}

          <footer className="footer">
            <div>⚡ Local LLM • No web search • No data collection • Offline-capable</div>
            <div style="margin-top:10px;font-size:.82rem">Knowledge cutoff: ~January 2025 • Results reflect training data</div>
            <div className="footer-links">
              <a className="footer-link" href="https://github.com/bohselecta/altiplano" target="_blank">GitHub</a>
              <a className="footer-link" href="https://altiplano-landing.vercel.app/" target="_blank">About</a>
              <a className="footer-link" href="https://altiplano-landing.vercel.app/" target="_blank">Limitations</a>
            </div>
          </footer>
        </div>
      );
    }

    ReactDOM.render(<App/>, document.getElementById('root'));
  </script>
</body>
</html>
